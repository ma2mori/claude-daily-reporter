# Claude Daily Reporter

Claude Code の会話履歴を日毎に抽出・保存し、AI分析による日報を自動生成するツールです。

## 概要

このツールは Claude Code の `~/.claude/projects/` から timestamp 基準で日次データを抽出し、JSONファイルとして保存します。さらに、Claude のAI分析機能を使用して、作業内容を自動的に整理した日報を生成します。

## 主な機能

- **Claude履歴の自動バックアップ**: 日付ごとに会話履歴をJSON形式で保存
- **AI分析による日報生成**: Claude APIを使用して作業内容を自動分析
- **プロジェクト名付き出力**: 各作業項目にプロジェクト名を自動付与
- **複数テンプレート対応**: シンプル版（作業内容のみ）と詳細版（統計情報付き）の2種類のテンプレート
- **アシスタントの作業内容も分析**: ユーザーメッセージだけでなく、実際に行った作業も抽出
- **既存ファイル上書き通知**: 同じ日付の日報が存在する場合は警告表示

## 前提条件

- Claude Code がインストールされ、使用されていること
- macOS 環境であること
- jq がインストールされていること (`brew install jq`)
- Claude CLI がインストールされていること（AI分析機能を使用する場合）

## 使用方法

### 1. ログの抽出

```bash
# 今日のログを抽出
./bin/claude-history-backup.sh

# 特定の日付のログを抽出
./bin/claude-history-backup.sh 2025-07-26
```

### 2. 日報の生成

```bash
# 今日の日報を生成（デフォルト: simpleテンプレート）
./bin/claude-daily-report.sh

# 特定の日付の日報を生成
./bin/claude-daily-report.sh 2025-07-26

# 詳細テンプレートを使用
./bin/claude-daily-report.sh 2025-07-26 detail
```

### 基本的なワークフロー

1. まずログを抽出: `./bin/claude-history-backup.sh`
2. 次に日報を生成: `./bin/claude-daily-report.sh`

## テンプレートシステム

### simple（デフォルト）- シンプルな日報
```bash
./bin/claude-daily-report.sh 2025-07-26 simple
# または
./bin/claude-daily-report.sh 2025-07-26
```
- 「今日やったこと」のみを記載
- 各項目にプロジェクト名を付与
- 最大10〜15項目まで表示

### detail - 詳細な日報
```bash
./bin/claude-daily-report.sh 2025-07-26 detail
```
- 「今日やったこと」セクション（simpleと同じ内容）
- 分析情報（Claude分析の実行状況）
- 統計情報（プロジェクト数、やり取り数等）
- 最も活発なプロジェクト情報
- より詳細なメタデータを含む日報

## 出力ファイル

### バックアップファイル
- **保存先**: `./backup/claude-history-YYYY-MM-DD.json`
- **形式**: JSON
- **内容**: プロジェクト別のセッション情報と統計データ

### 日報ファイル
- **保存先**: `./reports/daily-report-YYYY-MM-DD.md`
- **形式**: Markdown
- **内容**: AI分析された人間が読みやすい形式の日報

## 出力例

```markdown
# 日報 2025-01-16

## 作業項目

### auth-service
- ユーザー認証機能のバグ修正とテストケースの追加
- コードレビューとリファクタリング作業

### backend-api
- RESTful APIのエンドポイント設計とドキュメント作成

### web-frontend
- フロントエンドのレスポンシブ対応実装

### database
- データベーススキーマの最適化とインデックスの追加

### devops
- CI/CDパイプラインの設定更新とデプロイ自動化

## 統計
- 処理メッセージ数: 856件
- 対象プロジェクト数: 5件

---
*生成日時: 2025-01-16 18:30:00*
```

## ディレクトリ構成

```
claude-daily-reporter/
├── README.md                    # このファイル
├── .gitignore                   # Git除外設定
├── bin/
│   ├── claude-history-backup.sh # バックアップスクリプト
│   └── claude-daily-report.sh   # 日報生成スクリプト
├── templates/
│   ├── simple.md                # シンプル版テンプレート（デフォルト）
│   └── detail.md                # 詳細版テンプレート
├── backup/                      # バックアップファイル（実行時に作成）
└── reports/                     # 日報ファイル（実行時に作成）
```

## 技術詳細

### AI分析機能
- Claude CLIを使用して会話履歴を分析
- ユーザーメッセージとアシスタントの作業内容の両方を分析対象
- プロジェクト名を自動的に抽出して各作業項目に付与
- 共通化された分析処理により、テンプレートの違いはファイルレベルで制御

### メッセージ抽出の仕組み
1. **ユーザーメッセージ**: 実際の指示や質問
2. **アシスタントワーク**: ファイル作成・更新などの実作業
3. **ツール結果**: ファイル操作の結果情報

### フィルタリング
- 日報分析コマンド自体は除外
- 空行や短いメッセージは除外
- 最大200件のメッセージを分析対象

## トラブルシューティング

### よくある問題

1. **jq がインストールされていない**
   ```bash
   brew install jq
   ```

2. **~/.claude/projects が見つからない**
   - Claude Code を一度実行してプロジェクトファイルを生成してください

3. **権限エラー**
   ```bash
   chmod +x bin/claude-history-backup.sh
   chmod +x bin/claude-daily-report.sh
   ```

4. **Claude CLIが見つからない**
   - Claude CLIがインストールされていない場合、キーワード検索によるフォールバック処理が実行されます
   - より高精度な分析にはClaude CLIのインストールを推奨

5. **日報に作業内容が表示されない**
   - バックアップファイルが正しく生成されているか確認
   - その日に実際に作業を行ったか確認
   - Claude分析が失敗している場合はキーワード検索モードで動作

6. **既存ファイル上書きの警告**
   - 同じ日付の日報が既に存在する場合に表示されます
   - 問題なければそのまま実行を継続してください

## カスタマイズ

### テンプレートの追加
`templates/`ディレクトリに新しい`.md`ファイルを作成することで、カスタムテンプレートを追加できます。


## 安全性について

- **非破壊的**: `~/.claude/projects/` は読み取り専用でアクセス
- **プライバシー**: 履歴はローカルに保存され、外部に送信されません
- **バックアップ管理**: `.gitignore`により、backup/とreports/はGit管理対象外

## 今後の改善予定

- [ ] より詳細な作業内容の抽出
- [ ] デバッグモードの追加
- [ ] 週次・月次レポートの生成
- [ ] 複数プロジェクトの統合レポート

## ライセンス

MIT License